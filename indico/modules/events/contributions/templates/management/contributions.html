{% extends 'layout/full_content_base.html' %}
{% from 'events/contributions/management/_contribution_report.html' import render_contrib_report %}
{% from 'events/management/_reports.html' import render_displayed_entries_fragment %}

{% block title %}
    {% trans %}Contributions{% endtrans %}
{% endblock %}

{% block title_actions %}
    {%- if event.type == 'conference' -%}
        <a id="contributions-settings-dropdown"
           class="i-button inconspicuous icon-settings arrow js-dropdown"
           data-toggle="dropdown"></a>
        <ul class="dropdown">
            <li>
                <a href="#"
                   title="{% trans %}Manage contribution types{% endtrans %}"
                   data-ajax-dialog
                   data-reload-after="customData"
                   data-title="{% trans %}Manage contribution types{% endtrans %}"
                   data-href="{{ url_for('.manage_types', event) }}"
                   data-qtip-position="right">
                    {% trans %}Contribution types{% endtrans %}</a>
            </li>
            <li>
                <a href="#"
                   title="{% trans %}Manage custom fields{% endtrans %}"
                   data-ajax-dialog
                   data-reload-after="customData"
                   data-title="{% trans %}Manage custom fields{% endtrans %}"
                   data-href="{{ url_for('.manage_fields', event) }}"
                   data-qtip-position="right">
                    {% trans %}Custom fields{% endtrans %}</a>
            </li>
        </ul>
    {%- endif -%}
{% endblock %}

{% block content %}
    <div class="report-section">
        <div class="toolbar">
            <div class="group">
                <a class="i-button icon-checkbox-checked arrow js-dropdown" data-toggle="dropdown"></a>
                <ul class="dropdown">
                    <li>
                        <a href="#" data-select-all="#contribution-list input:checkbox">{% trans %}All{% endtrans %}</a>
                    </li>
                    <li>
                        <a href="#" data-select-none="#contribution-list input:checkbox">{% trans %}None{% endtrans %}</a>
                    </li>
                </ul>
            </div>
            <div class="group">
                <button class="i-button highlight icon-plus js-dialog-action"
                        title="{% trans %}Add new contribution{% endtrans %}"
                        data-title="{% trans %}Add new contribution{% endtrans %}"
                        data-href="{{ url_for('.manage_create_contrib', event) }}"
                        data-update='{"html": "#contribution-list", "counter": "#contributions-counter"}'
                        data-ajax-dialog>
                    {% trans %}New contribution{% endtrans %}
                </button>
            </div>
            <div class="group">
                <button class="i-button js-enable-if-checked icon-remove disabled"
                        title="{% trans %}Remove{% endtrans %}"
                        data-method="POST"
                        data-href="{{ url_for('.manage_delete_contribs', event) }}"
                        data-params-selector="#contribution-list input[name=contribution_id]:checked"
                        data-confirm="{% trans %}Do you really want to delete the selected contributions?{% endtrans %}"
                        data-title="{% trans %}Confirm deletion{% endtrans %}"
                        data-update='{"html": "#contribution-list", "counter": "#contributions-counter"}'>
                    {%- trans %}Remove{% endtrans -%}
                </button>
            </div>
            <div class="group">
                <button class="i-button icon-users js-enable-if-checked disabled"
                        data-title="{% trans %}Author list{% endtrans %}"
                        data-href="{{ url_for('contributions.person_list', event) }}"
                        data-params-selector="#contribution-list input[name=contribution_id]:checked"
                        data-method="POST"
                        data-dialog-classes="event-persons-dialog"
                        data-ajax-dialog>
                    {%- trans %}Author list{% endtrans -%}
                </button>
            </div>
            <div class="group">
                <a href="#" class="i-button icon-attachment js-enable-if-checked js-submit-form disabled"
                   data-href="{{ url_for('.material_package', event) }}">
                    {%- trans %}Material package{%- endtrans %}
                </a>
            </div>
            <div class="group">
                <a class="i-button js-enable-if-checked arrow disabled"
                   title="{% trans %}Export data{% endtrans %}"
                   data-toggle="dropdown">
                    {% trans -%}Export{%- endtrans %}
                </a>
                <ul class="dropdown">
                    <li>
                        <a href="#" class="icon-file-pdf js-submit-form js-enable-if-checked disabled"
                           data-href="{{ url_for('.contributions_pdf_export', event) }}">
                            {% trans -%}PDF{%- endtrans %}
                        </a>
                    </li>
                    <li>
                        <a href="#" class="icon-file-pdf js-submit-form js-enable-if-checked disabled"
                           data-href="{{ url_for('.contributions_pdf_export_book', event) }}">
                            {% trans -%}PDF (book of abstract){%- endtrans %}
                        </a>
                    </li>
                    <li>
                        <a href="#" class="icon-file-pdf js-submit-form js-enable-if-checked disabled"
                           data-href="{{ url_for('.contributions_pdf_export_book_sorted', event) }}">
                            {% trans -%}PDF (book of abstract - sorted by board number){%- endtrans %}
                        </a>
                    </li>
                    <li>
                        <a href="#" class="icon-file-spreadsheet js-submit-form js-enable-if-checked disabled"
                           data-href="{{ url_for('.contributions_csv_export', event) }}">
                            {% trans -%}CSV{%- endtrans %}
                        </a>
                    </li>
                    <li>
                        <a href="#" class="icon-file-excel js-submit-form js-enable-if-checked disabled"
                           data-href="{{ url_for('.contributions_excel_export', event) }}">
                            {% trans -%}XLSX (Excel){%- endtrans %}
                        </a>
                    </li>
                </ul>
            </div>
            <div class="group right">
                <span class="i-button label icon-search"></span>
                <input type="text" id="search-input" placeholder="{% trans %}Enter #id or search string{% endtrans %}">
            </div>
            <div class="right">
                <div class="group" id="contributions-counter">
                    {{ render_displayed_entries_fragment(contribs|length, total_entries) }}
                </div>
                <div class="group">
                    <button class="i-button icon-filter js-dialog-action"
                            data-href="{{ url_for('.customize_contrib_report', event) }}"
                            data-title="{% trans %}Contribution list configuration{% endtrans %}"
                            data-dialog-classes="report-filter-dialog"
                            data-update='{"html": "#contribution-list", "counter": "#contributions-counter"}'
                            data-ajax-dialog>
                        {% trans %}Filters{% endtrans %}
                    </button>
                </div>
                <div class="group">
                    <button class="i-button icon-link js-static-url"
                            data-href="{{ url_for('.generate_static_url', event) }}"
                            title="{% trans %}Generate a URL for the selected filters.{% endtrans %}"></button>
                </div>
            </div>
        </div>
        <div class="report" id="contribution-list">
            {{ render_contrib_report(event, total_entries, contribs, sessions, tracks) }}
        </div>
        <div id="filter-placeholder"></div>
    </div>
    <script>
        setupContributionList({
            createSessionURL: {{ url_for('sessions.create_session', event) | tojson }},
            createTrackURL: {{ url_for('tracks.create_track', event) | tojson }},
            timetableRESTURL: {{ url_for('timetable.timetable_rest', event, _method='POST') | tojson }}
        });
        {% if selected_entry %}
            $('#search-input').val('#{{ selected_entry }}');
            applySearchFilters();
        {% endif %}
    </script>
{% endblock %}
