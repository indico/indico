{% extends 'events/registration/management/_regform_base.html' %}

{% block content %}
    {% if not regform.has_started %}
        {% include 'events/registration/management/regform_actions/not_started.html' %}
    {% elif regform.is_active %}
        {% include 'events/registration/management/regform_actions/active.html' %}
    {% elif regform.has_ended %}
        {% include 'events/registration/management/regform_actions/ended.html' %}
    {% endif %}

    <div class="action-box">
        <div class="section">
            <div class="icon icon-settings"></div>
            <div class="text">
                <div class="label">
                    {% trans %}General settings{% endtrans %}
                </div>
                {% trans %}Edit settings for this registration process.{% endtrans %}
            </div>
            <div class="toolbar right">
                <a href="{{ url_for('.edit_regform', regform) }}" class="i-button icon-edit">
                    {% trans %}Edit{% endtrans %}
                </a>
            </div>
        </div>

        <div class="section">
            <div class="icon icon-clipboard"></div>
            <div class="text">
                <div class="label">
                    {% trans %}Registration Form{% endtrans %}
                </div>
                {% trans %}Add, remove or modify information registrants may fill out.{% endtrans %}
            </div>
            <div class="toolbar right">
                <a href="{{ url_for('.modify_regform', regform) }}" class="i-button icon-settings">
                    {% trans %}Configure{% endtrans %}
                </a>
            </div>
        </div>
        <div class="section">
            <div class="icon icon-coins"></div>
            <div class="text">
                <div class="label">
                    {% trans %}Payment settings{% endtrans %}
                </div>
                {% trans %}Configure payment settings{% endtrans %}
            </div>
            <div class="toolbar right">
                <a href="{{ url_for('payment.event_settings', event) }}" class="i-button icon-settings">
                    {% trans %}Configure{% endtrans %}
                </a>
            </div>
    </div>

    <h2>
        {% trans %}Inscriptions{% endtrans %}
    </h2>

    {% if regform.registrations %}
        <div>
            <div class="toolbar left">
                <a class="i-button icon-checkbox-checked arrow js-dropdown" data-toggle="dropdown"></a>
                <ul class="dropdown">
                    <li><a href="#" id="select-all">
                        {% trans %}All{% endtrans %}
                    </a></li>
                    <li><a href="#" id="select-none">
                        {% trans %}None{% endtrans %}
                    </a></li>
                </ul>
            </div>
            <div class="toolbar right">
                <div class="group">
                    <a href="" class="i-button icon-chart">
                        {% trans %}Summary{% endtrans %}
                    </a>
                </div>
                <div class="group">
                    <button id="export-registrations" data-href=""
                            class="i-button icon-file-excel">
                        {% trans %}Export{% endtrans %}
                    </button>
                </div>
                <div class="group">
                    <button id="delete-registrations" data-href=""
                            data-title="{% trans %}Remove all selected inscriptions?{% endtrans %}"
                            data-confirm="{% trans %}Are you sure you want to remove all selected inscriptions?{% endtrans %}"
                            data-method="DELETE" class="i-button icon-remove" disabled>
                        {% trans %}Delete{% endtrans %}
                    </button>
                </div>
            </div>
        </div>

        <table id="registration-list" class="i-table-widget fixed-width">
            <thead>
                <tr>
                    <th></th>
                    <th>{% trans %}ID{% endtrans %}</th>
                    <th>{% trans %}Submitted{% endtrans %}</th>
                    <th>{% trans %}User{% endtrans %}</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for registration in regform.registrations %}
                    {{ _render_submission_row(registration) }}
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="info-message-box">
            <div class="message-text">
                {% trans %}There are no inscriptions yet.{% endtrans %}
            </div>
        </div>
    {% endif %}
{% endblock %}


{% macro _render_registration_row(registration) %}
    <tr>
        <td>
            <input type="checkbox" class="inline-vcentered registrations-ids" value="{{ registration.id }}">
        </td>
        <td>
            <a href="">{{ registration.id }}</a>
        </td>
        <td>{{ registration.submitted_dt|format_datetime }}</td>
        <td>
            {% if registration.user %}
                {{ registration.user.full_name }}
            {% else %}
                {# TODO: get the name from RegistrationData? #}
            {% endif %}
        </td>
        <td>
            <a href="#" class="icon-remove right"
               data-href=""
               data-method="DELETE"
               data-title="{% trans %}Remove inscription?{% endtrans %}"
               data-confirm="{% trans %}Are you sure you want to remove this inscription?{% endtrans %}"
               data-registration-id="{{ registration.id }}"></a>
        </td>
    </tr>
{% endmacro %}
