{% macro render_registration_info(registration) %}
    {% for section in registration.registration_form.sections -%}
        <tr>
            <td class="regform-done-title">{{ section.title }}</td>
        </tr>
        {% for field in section.children if field.is_field and field.id in registration.data_by_field -%}
            <tr>
                <td class="regform-done-caption">{{ field.title }}</td>
                <td class="regform-done-data">
                    {{ render_data(registration, field) }}
                </td>
            </tr>
        {%- endfor %}
    {%- endfor %}
{% endmacro %}

{% macro render_data(registration, field) %}
    {% set friendly_data = registration.data_by_field[field.id].friendly_data %}
    {% if field.input_type == 'accommodation' %}
        <div>
            {% trans arrival_date=friendly_data['arrival_date'] | format_date -%}
                <strong>Arrival:</strong> {{ arrival_date }}
            {%- endtrans %}
        </div>
        <div>
            {% trans departure_date=friendly_data['departure_date'] | format_date -%}
                <strong>Departure:</strong> {{ departure_date }}
            {%- endtrans %}
        </div>
        <div>
            {% trans accommodation=friendly_data['choice'] -%}
                <strong>Accommodation:</strong> {{ accommodation }}
            {%- endtrans %}
        </div>
    {% elif field.input_type == 'multi_choice' %}
        <ul>
            {% for item in friendly_data -%}
                <li>{{ item }}</li>
            {%- endfor %}
        </ul>
    {% else %}
        {{ friendly_data }}
    {% endif %}
{% endmacro %}

{% macro render_registration_summary(registration) %}
    <div id="registration-summary" class="regform-done">
        <div class="i-box-header">
            <div class="i-box-title">
                {% trans %}Summary{% endtrans %}
            </div>
            <div class="i-box-metadata">
                <span class="label">
                    {% trans %}Reference:{% endtrans %}
                </span>
                <span class="content">
                    #{{ registration.friendly_id }}
                </span>
                <span class="label">
                    {% trans %}Date:{% endtrans %}
                </span>
                <span class="content">
                    {{ registration.submitted_dt|format_date }}
                </span>
            </div>
        </div>
        <div class="i-box-content">
            <table class="registration-info">
                {{ render_registration_info(registration) }}
            </table>
        </div>
    </div>
{% endmacro %}

{% macro render_payment_summary(registration, payment_enabled, currency, payment_conditions=false) %}
    {% if payment_enabled and registration.price %}
        <div id="payment-summary" class="regform-done">
            <div class="i-box-header">
                <div class="i-box-title">
                    {% trans %}Invoice{% endtrans %}
                </div>
                {% if not registration.transaction or registration.transaction.status not in ('successful', 'pending') %}
                    <div class="payment-status payment-not-paid right">
                        {% trans %}Not paid{% endtrans %}
                        <i class="icon-time"></i>
                    </div>
                {% elif registration.transaction.status.name == 'successful' %}
                    <div class="payment-status payment-done right">
                        {% trans %}Paid{% endtrans %}
                        <i class="icon-checkbox-checked"></i>
                    </div>
                {% elif registration.transaction and registration.transaction.status.name == 'pending' %}
                    <div class="payment-status payment-pending right">
                        {% trans %}Pending{% endtrans %}
                        <i class="icon-time"></i>
                    </div>
                {% endif %}
            </div>
            <div class="i-box-content">
                <table class="registration-info payment-info">
                    <tr>
                        <td class="regform-done-table-title">
                            {% trans %}Item{% endtrans %}
                        </td>
                        <td class="regform-done-table-title">
                            {% trans %}Value{% endtrans %}
                        </td>
                        <td class="regform-done-table-title text-right">
                            {% trans %}Cost{% endtrans %}
                        </td>
                    </tr>
                    {% for item in registration.billable_data %}
                        <tr class="regform-done-table-item">
                            <td class="text-left">
                                {{- item.field_data.field.title }}
                                <span class="section-name">({{ item.field_data.field.parent.title -}})</span>
                            </td>
                            <td class="text-left">
                                {% if item.field_data.field.input_type == 'accommodation' %}
                                    {% trans nights=item.friendly_data.nights,
                                             choice=item.friendly_data.choice %}
                                        {{ choice }} ({{ nights }} night)
                                    {%- pluralize -%}
                                        {{ choice }} ({{ nights }} nights)
                                    {% endtrans %}
                                {% elif item.field_data.field.input_type == 'multi_choice' %}
                                    {{ item.friendly_data | join(', ') }}
                                {% else %}
                                   {{ item.friendly_data }}
                                {% endif %}
                            </td>
                            <td class="text-right">{{ item.price }} {{ currency }}</td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td class="regform-done-table-total text-right" colspan="2">
                            <strong>{% trans %}Total{% endtrans %}</strong>
                        </td>
                        <td class="regform-done-table-total text-right">
                            {{ registration.render_price() }}
                        </td>
                    </tr>
                </table>
                {{ caller() }}
            </div>
        </div>
    {% endif %}
{% endmacro %}
