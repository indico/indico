{% extends 'events/papers/_base.html' %}

{% from 'events/reviews/timeline.html' import render_timeline %}
{% from 'events/reviews/_common.html' import render_summary_state, render_user_avatar %}

{% macro render_file_list(files) %}
    <table class="tree">
        <tbody>
            {% for file in files %}
                {% set icon = icon_from_mimetype(file.content_type, 'icon-file-filled') %}
                <tr>
                    <td>
                        <a class="attachment {{ icon }}" href="{{ url_for('.download_file', file) }}"
                           title="{{ file.filename }}">
                            <span class="title">{{ file.filename }}</span>
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endmacro %}

{% macro render_paper_info(contribution) %}
    {% set paper = contribution.paper_last_revision %}
    <div class="submission-title flexrow">
        <h3 class="f-self-stretch">
            {% trans contribution_title=contribution.title%}Paper for {{ contribution_title }}{% endtrans %}
            <span class="submission-id">
                #{{ contribution.friendly_id }}
            </span>
        </h3>
    </div>
    <div id="paper-public">
        {{ _render_paper_summary(contribution) }}
        <div class="reviewing-item-content paper-content">
            <h3>{% trans %}Latest revision files{% endtrans %}</h3>
            {{ render_file_list(paper.files) }}
        </div>
    </div>
    <div class="i-timeline">
        <div class="i-timeline-item">
            {{ render_user_avatar(paper.submitter) }}
            <div class="i-timeline-item-box header-indicator-left">
                <div class="i-box-header">
                    {% trans name=paper.submitter.name -%}
                        <strong>{{ name }}</strong> submitted this paper
                    {%- endtrans %}
                    <time datetime="{{ paper.submitted_dt.isoformat() }}">
                        {{- paper.submitted_dt|format_human_date -}}
                    </time>
                </div>
                <div class="i-box-content submission-info">
                    {{ render_file_list(paper.files) }}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro _render_paper_summary(contribution) %}
    {% set paper = contribution.paper_last_revision %}
    <div class="review-summary flexrow f-a-baseline">
        <div class="review-summary-badge">
            {{ render_summary_state(paper.state) }}
        </div>
        <div class="review-summary-content f-self-stretch">
            <div>
                {% trans name=paper.submitter.name -%}
                    <strong>{{ name }}</strong> submitted this paper for the contribution
                {%- endtrans %}
                <a href="{{ url_for('contributions.display_contribution', contribution) }}">
                    {{- contribution.title -}}
                </a>
            </div>
        </div>
    </div>
{% endmacro %}

{% block back_button_url -%}
    {% if management -%}
        {{ url_for('contributions.display_contribution', contribution) }}
    {%- endif %}
{%- endblock %}

{% block back_button_title -%}
    {% if management %}
        {%- trans %}Back to the contribution{% endtrans -%}
    {% endif %}
{% endblock %}

{% block content %}
    {{ render_paper_info(contribution) }}

    <div class="i-timeline">
        {# TODO #}
    </div>

    {% if not no_javascript %}
        <script>
            setupReviewingPage();
        </script>
    {% endif %}
{% endblock %}
