{% from 'message_box.html' import message_box %}

{% macro render_paper_assignment_list(event, total_entries, contribs, static_columns) %}
    {% if not contribs %}
        {%- call message_box('info') %}
            {%- if total_entries %}
                {%- trans -%}
                    The filtering criteria do not match with any of the existing contributions. Try to clear the filters.
                {%- endtrans %}
            {%- else %}
                {%- trans %}There are no contributions yet.{% endtrans %}
            {%- endif %}
        {%- endcall %}
    {%- else %}
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
            <table class="i-table tablesorter">
                <thead>
                    <tr class="i-table">
                        <th class="i-table thin-column" data-sorter="false"></th>
                        <th class="i-table id-column">
                            {%- trans %}ID{% endtrans -%}
                        </th>
                        <th class="i-table title-column">
                            {%- trans %}Title{% endtrans -%}
                        </th>
                        {% for item in static_columns %}
                            <th class="i-table">{{ item.caption }}</th>
                        {% endfor %}
                        <th class="i-table revision-column">
                            {%- trans %}Revision{% endtrans -%}
                        </th>
                        <th class="i-table judge-column" data-sorter="false">
                            {%- trans %}Judges{% endtrans -%}
                        </th>
                        <th class="i-table content-reviewers-column" data-sorter="false">
                            {%- trans %}Content reviewers{% endtrans -%}
                        </th>
                        <th class="i-table layout-reviewers-column" data-sorter="false">
                            {%- trans %}Layout reviewers{% endtrans -%}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for contrib in contribs %}
                        {% if contrib.paper %}
                            {% set last_revision_state = contrib.paper.last_revision.state.title %}
                        {% else %}
                            {% set last_revision_state %}
                                {%- trans %}Paper not yet submitted{% endtrans -%}
                            {% endset %}
                        {% endif %}
                        <tr id="contrib-{{ contrib.id }}" class="i-table contribution-row"
                            data-friendly-id="{{ contrib.friendly_id }}"
                            data-title="{{ contrib.title }}">
                            <td class="i-table id-column">
                                <span class="vertical-aligner">
                                    <input type="checkbox" class="select-row"
                                           name="contribution_id"
                                           value="{{ contrib.id }}">
                                </span>
                            </td>
                            <td class="i-table id-column">
                                <span class="vertical-aligner">{{ contrib.friendly_id }}</span>
                            </td>
                            <td class="i-table title-column"
                                data-searchable="{{ contrib.title | lower }}"
                                data-text="{{ contrib.title | lower }}">
                                <span class="vertical-aligner">
                                    {% if contrib.paper %}
                                        <a href="{{ url_for('.paper_timeline', contrib) }}">
                                            {{- contrib.title -}}
                                        </a>
                                    {% else %}
                                        {{- contrib.title -}}
                                    {% endif %}
                                </span>
                            </td>
                            {% for item in static_columns %}
                                {% if item.id == 'state' %}
                                    <td class="i-table"
                                        data-searchable="{{ last_revision_state | lower }}">
                                        <span class="vertical-aligner">{{ last_revision_state }}</span>
                                    </td>
                                {% elif item.id == 'track' %}
                                    <td class="i-table"
                                        data-searchable="{{ contrib.track.title | lower }}">
                                        <span class="vertical-aligner">
                                            {%- if contrib.track -%}
                                                {{ contrib.track.title }}
                                            {%- else -%}
                                                {% trans %}No track{% endtrans %}
                                            {%- endif -%}
                                        </span>
                                    </td>
                                {% elif item.id == 'session' %}
                                    <td class="i-table"
                                        data-searchable="{{ contrib.session.title | lower }}">
                                        <span class="vertical-aligner">
                                            {%- if contrib.session -%}
                                                {% trans title=contrib.session.title -%}
                                                    {{ title }}
                                                {%- endtrans %}
                                            {%- else -%}
                                                {% trans %}No session{% endtrans %}
                                            {%- endif -%}
                                        </span>
                                    </td>
                                {% elif item.id == 'type' %}
                                    <td class="i-table"
                                        data-searchable="{{ contrib.type.name | lower }}">
                                        <span class="vertical-aligner">
                                            {%- if contrib.type -%}
                                                {{ contrib.type.name }}
                                            {%- else -%}
                                                {% trans %}n/a{% endtrans %}
                                            {%- endif -%}
                                        </span>
                                    </td>
                                {% endif %}
                            {% endfor %}
                            <td class="i-table revision-column">
                                <span class="vertical-aligner">
                                    {%- if contrib.paper.revision_count -%}
                                        {{ contrib.paper.revision_count }}
                                    {%- endif -%}
                                </span>
                            </td>
                            <td class="i-table person-row-cell"
                                data-searchable="{{ contrib.paper_judges|join(', ', attribute='name')|lower }}">
                                <span class="vertical-aligner">
                                    {% for judge in contrib.paper_judges -%}
                                        <div class="person-row icon-user">{{ judge.display_full_name }}</div>
                                    {%- endfor %}
                                </span>
                            </td>
                            <td class="i-table person-row-cell"
                                data-searchable="{{ contrib.paper_content_reviewers|join(', ', attribute='name')|lower }}">
                                <span class="vertical-aligner">
                                    {% for reviewer in contrib.paper_content_reviewers -%}
                                        <div class="person-row icon-user">{{ reviewer.display_full_name }}</div>
                                    {%- endfor %}
                                </span>
                            </td>
                            <td class="i-table person-row-cell"
                                data-searchable="{{ contrib.paper_layout_reviewers|join(', ', attribute='name')|lower }}">
                                <span class="vertical-aligner">
                                    {% for reviewer in contrib.paper_layout_reviewers -%}
                                        <div class="person-row icon-user">{{ reviewer.display_full_name }}</div>
                                    {%- endfor %}
                                </span>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    {%- endif %}
{% endmacro %}
