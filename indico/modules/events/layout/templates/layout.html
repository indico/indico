{% extends 'layout/base.html' %}
{% from 'forms/_form.html' import form_header, form_footer, form_rows, form_row, form_fieldset %}

{% block title %}
    {%- trans %}Layout{% endtrans -%}
{% endblock %}

{%- block content %}
    {{ form_header(form, action=url_for('event_layout.index', event)) }}
    {% call form_fieldset(_('General')) %}
        {{ form_rows(form, fields=('is_searchable', 'show_nav_bar', 'show_banner', 'show_social_badges')) }}
    {% endcall %}
    {% call form_fieldset(_('Stylesheets')) %}
        {% call form_row(form.theme) %}
            <a class="i-button i-form-field-button icon-eye" target="_blank"
               href="{{ url_for('event_layout.css_preview', event) }}">
                {%- trans %}Preview{% endtrans -%}
            </a>
        {% endcall %}
        {{ form_row(form.css_file) }}
    {% endcall %}
    {% call form_fieldset(_('Header Style')) %}
    {{ form_rows(form, fields=('logo', 'header_text_color', 'header_background_color')) }}
    {% endcall %}
    {% call form_fieldset(_('Announcement')) %}
        {{ form_rows(form, fields=('announcement', 'show_announcement')) }}
    {% endcall %}
    {% call form_footer(form) %}
        <input class="i-button big highlight" type="submit" value="{% trans %}Save{% endtrans %}" data-disabled-until-change>
    {% endcall %}
    <script>
        $(document).ready(function() {
            $('#theme').nullableselector({nullvalue: ''})
            .on('change', function() {
                var preview_url = build_url({{ url_for('event_layout.css_preview', event) | tojson }}, {
                    theme: $(this).val()
                });
                $(this).nextAll('.i-form-field-button').attr('href', preview_url);
            })
            .trigger('change');
        });
    </script>
{%- endblock %}
