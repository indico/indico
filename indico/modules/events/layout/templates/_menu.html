{% macro menu_entry(entry) -%}
    <div class="menu-entry {%- if entry.parent_id is none and entry.children %} with-children{% endif %}"
         data-position="{{ entry.position }}"
         data-position-url="{{ url_for('.menu_entry_position', entry) }}">
        <div class="i-label
            {%- if entry.type.name in ('internal_link', 'plugin_link') %} disabled
            {%- elif entry.type.name in ('user_link', 'page') %} highlight{% endif -%}
            {%- if not entry.is_enabled %} stripped{% endif %} entry-{{ entry.type.name }}">
            <span>{%- if entry.type.name != 'separator' %}{{ _(entry.title) }}{% endif %}</span>
            <span class="right actions">
                <a class="{% if not entry.is_enabled %}not-{% endif %}enabled" href="#"
                   data-href="{{ url_for('.menu_enable_entry', entry) }}"
                   data-method="POST"
                ></a>
                {% if entry.type.name != 'separator' %}
                    <a href="#" data-href="{{ url_for('.menu_entry_edit', entry) }}" class="edit-entry"></a>
                {% endif %}
                {% if entry.type.name in ('user_link', 'page', 'separator') %}
                    <a href="#" class="delete-entry"
                         data-method="DELETE"
                         data-href="{{ url_for('.menu_delete_entry', entry) }}"
                         data-title="{% trans%}Remove the menu entry?{% endtrans %}"
                         data-confirm="
                            {%- if entry.type.name != 'separator' -%}
                                {%- trans name=entry.title -%}
                                    Are you sure you want to remove &quot;{{ name }}&quot;?
                                {%- endtrans -%}
                            {% else %}
                                {%- trans name=entry.title -%}
                                    Are you sure you want to remove this spacer?
                                {%- endtrans -%}
                            {% endif %}">
                    </a>
                {% endif %}
                <i class="drag-handle"></i>
            </span>
        </div>
        {% if entry.parent_id is none and entry.children %}
            {{ menu_entries(entry.children) }}
        {% endif %}
    </div>
{%- endmacro %}

{% macro menu_entries(entries) -%}
    <ul class="menu-entries">
        {% for entry in entries if not entry.is_orphaned -%}
            <li>{{ menu_entry(entry) }}</li>
        {%- endfor %}
    </ul>
{%- endmacro %}


{% macro menu_entry_display(entry, root_entry=true, active_entry_id=none) %}
    {%- if entry.is_separator -%}
        <li class="spacer"></li>
    {%- else -%}
        {% set menu_class = 'menuConfTitle' if root_entry else 'menuConfMiddleCell' %}
        <li class="{{ menu_class }}
            {%- if entry.id == active_entry_id %} selected menuConfSelected
                    {%- if not root_entry %} sublink{% endif -%}
            {%- endif %}">
            <a href="{{ entry.url }}" {%- if entry.new_tab %} target="_blank"{% endif %}>{{ entry.title }}</a>
            {%- if root_entry and entry.children -%}
                <ul class="inner">
                    {%- for child in entry.children if child.is_visible -%}
                        {{ menu_entry_display(child, root_entry=False, active_entry_id=active_entry_id) }}
                    {%- endfor -%}
                </ul>
            {%- endif -%}
    {%- endif -%}
{% endmacro %}
