{% extends 'events/abstracts/management/_base.html' %}

{% from 'events/abstracts/abstract/public.html' import render_abstract_public %}
{% from 'events/abstracts/abstract/judge.html' import render_decision_box %}
{% from 'events/abstracts/abstract/review.html' import render_abstract_reviews, render_abstract_comments, render_review_boxes, render_reviewed_for_tracks_box %}

{% block content %}
    {{ render_abstract_public(abstract, management=management) }}
    <div id="abstract-private" class="i-timeline">
        {% if abstract.comments or abstract.reviews %}
            <div class="i-timetable-connect-down"></div>
        {% endif %}
        <div class="i-timeline-separator"></div>
        {{ render_abstract_comments(abstract) }}
        {% if abstract.reviews %}
            {{ render_abstract_reviews(abstract, review_forms, management=management) }}
            <div class="i-timeline-separator"></div>
        {% endif %}

        {% set can_review = abstract.can_review(session.user, check_state=true) %}
        {% set can_judge = abstract.can_judge(session.user, check_state=true) %}

        {% if can_review or can_judge %}
            <div class="i-timetable-connect-up"></div>
        {% endif %}

        {% if can_review %}
            {{ render_review_boxes(abstract, review_forms, management=management) }}
        {% endif %}

        {% if can_judge %}
            {{ render_reviewed_for_tracks_box(abstract, review_track_list_form, management=management) }}
            <div id="abstract-decision-box" class="i-timeline-item">
                {{ render_decision_box(abstract, judgment_form, management=management) }}
            </div>
        {% endif %}
    </div>

    {% if not no_javascript %}
        <script>
            setupAbstractPage();
        </script>
    {% endif %}
{% endblock %}
