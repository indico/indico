{% macro _render_template(tpl, target, inherited=false, event=none) -%}
    <tr>
        <td class="i-table id-column">
            <i class="designer-template-type-icon icon-mail" title="{{ tpl.type }}"></i>
        </td>
        <td>
            <strong>{{ tpl.title }}</strong>
            <div>
                {{ tpl.type.replace('_', ' ').title() }} {% if tpl.type == 'registration_state_update' %} Â· {{ tpl.rules['status'].title() }}{% endif %}
            </div>
        </td>

        <td class="text-superfluous">
            {% if inherited %}
                {% if not tpl.category.is_root %}
                    {% trans title=tpl.category.title -%} from category "{{ title }}" {% endtrans %}
                {% endif %}
            {% endif %}
        </td>
        <td>
            <div class="thin toolbar right">
                <div class="group">
                    {% if tpl.is_default(target) %}
                        {# FIXME: MOVE this CSS #}
                        <span class="i-button icon icon-circle-small borderless" style="color: #4CAF50; pointer-events: none; cursor: default;" title="Active"></span>
                    {% else %}
                        <span class="i-button icon icon-circle-small borderless"
                              style="pointer-events: none; cursor: default;" title="Inactive"></span>
                    {% endif %}
                    <button class="i-button icon-copy icon-only text-color borderless hide-if-locked"
                        data-href="{{ url_for('email_templates.clone_email_template', tpl, target) }}"
                        title="{% trans %}Clone this template{% endtrans %}"
                        data-update="#template-list"
                        {% if event %}
                            data-method="POST"
                            data-confirm="{% trans title=tpl.title -%}Are you sure you want to clone template '{{ title }}'? {%- endtrans %}">
                        {% else %}
                            data-title="{% trans title=tpl.title %}Clone '{{ title }}' template into a category{% endtrans %}"
                            data-ajax-dialog>
                        {% endif %}
                    </button>
                    {% if not inherited %}
                        <a class="i-button icon-edit icon-only text-color borderless"
                           data-href="{{ url_for('email_templates.edit_email_template', tpl) }}"
                           data-title="{% trans %}Edit template{% endtrans %}"
                           data-update="#template-list"
                           data-ajax-dialog
                           title="{% trans %}Edit template{% endtrans %}">
                        </a>
                    {% endif %}
                    {% if not inherited %}
                        <button class="i-button icon-remove icon-only text-color borderless danger"
                                title="{% trans %}Delete template{% endtrans %}"
                                data-href="{{ url_for('email_templates.delete_email_template', tpl) }}"
                                data-method="DELETE"
                                data-update="#template-list"
                                data-confirm="{% trans title=tpl.title -%}
                                                Are you sure you want to delete the template '{{ title }}'?
                                              {%- endtrans %}">
                        </button>
                    {%- endif %}
                </div>
            </div>
        </td>
    </tr>
{% endmacro -%}

{% macro render_email_template_list(email_templates, target, inherited_templates=[], event=none) -%}
    {% if inherited_templates %}
        <section>
            <h3>{% trans %}Inherited templates{% endtrans %}</h3>
            <table class="i-table-widget">
                <tbody>
                {% for tpl in inherited_templates | sort(attribute='title') | sort(attribute='type') %}
                    {{ _render_template(tpl, target, inherited=true, event=event) }}
                {% endfor %}
                </tbody>
            </table>
        </section>
    {% endif %}

    <section class="custom-template-list">
        <div class="flexrow f-a-center f-j-space-between">
            <h3>{% trans %}Custom templates{% endtrans %}</h3>
            <button class="i-button highlight icon-plus hide-if-locked"
                    data-href="{{ url_for('email_templates.add_email_template', target) }}"
                    data-title="{% trans %}Add a new email template{% endtrans %}"
                    data-update="#template-list"
                    data-ajax-dialog>
                {% trans 'Custom template' %}Add new{% endtrans %}
            </button>
        </div>
        {% if email_templates %}
            <table class="i-table-widget">
                <tbody>
                {% for tpl in email_templates | sort(attribute='title') | sort(attribute='type') %}
                    {{ _render_template(tpl, target, event=event) }}
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="italic text-not-important">
                {% trans %}No templates{% endtrans %}
            </div>
        {% endif %}
    </section>
{% endmacro -%}
