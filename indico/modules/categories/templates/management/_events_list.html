{% from 'pagination.html' import render_pagination %}

{% macro event_row(event) %}
    <tr class="i-table">
        <td class="i-table column-icon">
            <a href="" class="i-button-icon icon-handle"></a>
        </td>
        <td class="i-table column-icon">
            {% if event.is_self_protected %}
                <span class="icon-lock icon-protection-self"></span>
            {% elif event.is_public %}
                <span class="icon-unlocked icon-protection-public"></span>
            {% endif %}
        </td>
        <td class="i-table">
            <a href="{{ url_for('event_mgmt.conferenceModification-managementAccess', event) }}">
                {{ event.title }}
            </a>
        </td>
        <td class="i-table">{{ event.start_dt|format_datetime(timezone=event.timezone) }}</td>
        <td class="i-table actions">
            <a href="#"
               class="i-button-icon icon-remove"
               title="{% trans %}Delete event{% endtrans %}"
               data-href="{{ url_for('event_management.delete', event) }}"
               data-ajax-dialog
               data-reload-after></a>
            <a class="i-button-icon icon-transmission"
               title="{% trans %}Move to different category{% endtrans %}"></a>
            <a href="{{ url_for('event.conferenceDisplay', event) }}"
               class="i-button-icon icon-arrow-right"
               title="{% trans %}Go to the event display page{% endtrans %}"></a>
        </td>
    </tr>
{% endmacro %}

{% macro events_table(category, page, is_paginated, order_column, direction, events) %}
    <table class="i-table event-management">
        <thead>
            <tr class="i-table">
                <th class="i-table column-icon"></th>
                <th class="i-table column-icon"></th>
                <th class="i-table sortable-column {{ direction if order_column == 'title' else ''}}">
                    <a href="{{ url_for('.manage_content', category, page=page,
                                        desc=(0 if direction == 'desc' and order_column == 'title' else 1),
                                        order='title') }}">{% trans %}Title{% endtrans %}</a>
                </th>
                <th class="i-table sortable-column {{ direction if order_column == 'start_dt' else ''}}">
                    <a href="{{ url_for('.manage_content', category, page=page,
                                        desc=(0 if direction == 'desc' and order_column == 'start_dt' else 1),
                                        order='start_dt') }}">{% trans %}Start date{% endtrans %}</a>
                </th>
                <th class="i-table actions"></th>
            </tr>
        </thead>
        {% set events_list = events.items if is_paginated else events %}
        {% for event in events_list %}
            {{ event_row(event) }}
        {% endfor %}
    </table>
    {% if is_paginated %}
        {% call(page) render_pagination(events) %}
            {{ url_for('.manage_content', category, page=page,
                       desc=(1 if direction == 'desc' else 0), order=order_column) }}
        {% endcall %}
    {% endif %}
{% endmacro %}

{% macro render_events_list(category, page, is_paginated, order_column, direction, events, event_count) %}
    <div class="toolbar">
        <div class="group">
            <a href="#" class="i-button js-dropdown arrow" data-toggle="dropdown">
                {% trans %}Create event{% endtrans %}
            </a>
            <ul class="dropdown">
                <li>
                    <a href="{{ url_for('event_creation.conferenceCreation', categId=category.id, event_type='lecture') }}">
                        {% trans %}Create lecture{% endtrans %}
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('event_creation.conferenceCreation', categId=category.id, event_type='meeting') }}">
                        {% trans %}Create meeting{% endtrans %}
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('event_creation.conferenceCreation', categId=category.id, event_type='conference') }}">
                        {% trans %}Create conference{% endtrans %}
                    </a>
                </li>
            </ul>
        </div>
        {% if event_count %}
            <div class="group">
                {% if is_paginated %}
                    {% if events.pages > 1 %}
                        <a href="{{ url_for('.manage_content', category, page='all', order=order_column,
                                            desc=(1 if direction == 'desc' else 0)) }}"
                           class="i-button">{% trans %}Show all events{% endtrans %}</a>
                    {% endif %}
                {% else %}
                    <a href="{{ url_for('.manage_content', category, page=1, order=order_column,
                                        desc=(1 if direction == 'desc' else 0)) }}"
                       class="i-button">{% trans %}Paginate the results{% endtrans %}</a>
                {% endif %}
            </div>
            <div class="group right">
                <a href="" class="i-button icon-transmission"></a>
                <a href="" class="i-button icon-remove"></a>
            </div>
        {% endif %}
    </div>
    <div id="event-management">
        {% if event_count %}
            {{ events_table(category, page, is_paginated, order_column, direction, events) }}
        {% else %}
            <div class="info-message-box">
                <div class="message-text">
                    {% trans %}There are no events in this category{% endtrans %}
                </div>
            </div>
        {% endif %}
    </div>
{% endmacro %}
